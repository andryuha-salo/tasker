<html>
	<script type="text/javascript">
		const shuffleArray = array => {
		  for (let i = array.length - 1; i > 0; i--) {
		    const j = Math.floor(Math.random() * (i + 1));
		    const temp = array[i];
		    array[i] = array[j];
		    array[j] = temp;
		  }
		}
		
		function parseTasks(input) {
		  input = input.replace(/\n/g, " ").replace(/\t/g, " ").replace(/Task/g, "").replace(/Bug/g, "");
		  let tasksNumbers = [...input.matchAll("SEARCH-[0-9]+")];
		  return tasksNumbers.map(function(value, index) {
			  let taskNumber = value[0];
			  let next = tasksNumbers[index+1];
			  let startIndex = input.indexOf(taskNumber) + taskNumber.length;
			  let endIndex = input.length;
			  if (next != undefined) {
			  	endIndex = input.indexOf(next);
			  }
			  return [taskNumber, input.substring(
				  startIndex,
				  endIndex
			  ).trim()]
		  })
		}
		
		function formatTasks(textbox) {
		  let tasks = parseTasks(textbox.value);
		  textbox.value = tasks.reduce((cV, pV) => cV + pV[0] + " " + pV[1] + "\n", "");
		}
		
		function shuffle() {
		  let tasksBox = document.getElementById("tasks");
		  let tasks = parseTasks(tasksBox.value);
		
		  let peopleBox = document.getElementById("people");
		  let people = peopleBox.value.split("\n");
		  shuffleArray(people);
		
		  let humanIdx = 0;
		  let output = "";
		  for (const task of tasks) {
		    output += task[0] + " " + task[1] + " - " + people[humanIdx] + "\n";
		    humanIdx += 1;
		    if (humanIdx > people.length - 1) {
		      humanIdx = 0;
		    }
		  }
		
		  let outputBox = document.getElementById("output");
		  outputBox.value = output;
		}
	</script>
	<head>
		<link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
	</head>
	<style>
		textarea {
		-webkit-box-sizing: border-box;
		-moz-box-sizing: border-box;
		box-sizing: border-box;
		width: 100%;
		resize: none;
		}
	</style>
	<body>
		<div style="text-align: center;">
			<table style="margin: auto;">
				<tr>
					<th>Tasks</th>
					<th>People</th>
					<th>Output</th>
				</tr>
				<tr>
					<td><textarea cols="100" rows="15" id="tasks" onchange="formatTasks(this)"></textarea></td>
					<td><textarea cols="20" rows="15" id="people">Анатолий&#10;Андрей&#10;Владислав&#10;Константин&#10;Марк&#10;Роман&#10;Сергей</textarea></td>
					<td><textarea readonly cols="100" rows="15" id="output"></textarea></td>
				</tr>
			</table>
			<button style="clear: both;" type="button" id="shuffle" onclick="shuffle()">shuffle!</button> 
		</div>
	</body>
</html>
